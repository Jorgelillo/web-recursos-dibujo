---
import Layout from '../layouts/Layout.astro';
import { getCollection } from 'astro:content';

// Traemos todos los recursos para poder contar cu√°ntas tareas hay por efem√©ride
const tareas = await getCollection('tareas');

// Definimos el orden cronol√≥gico del curso y las efem√©rides
const cursoEscolar = [
  { mes: 'Septiembre', icono: 'üéí', eventos: ['Vuelta al cole'] },
  { mes: 'Octubre', icono: 'üçÇ', eventos: ['Halloween'] },
  { mes: 'Noviembre', icono: 'üå∞', eventos: ['D√≠a del Flamenco', '25N Violencia de G√©nero'] },
  { mes: 'Diciembre', icono: '‚ùÑÔ∏è', eventos: ['Navidad'] },
  { mes: 'Enero', icono: 'üïäÔ∏è', eventos: ['D√≠a de la Paz'] },
  { mes: 'Febrero', icono: 'üé≠', eventos: ['Carnaval', 'San Valent√≠n'] },
  { mes: 'Marzo', icono: 'üíú', eventos: ['8 de Marzo'] },
  { mes: 'Abril', icono: 'üìö', eventos: ['D√≠a del Libro', 'D√≠a del Arte'] },
  { mes: 'Mayo', icono: 'üèõÔ∏è', eventos: ['D√≠a de los Museos'] },
  { mes: 'Junio', icono: '‚òÄÔ∏è', eventos: ['Medio Ambiente', 'Fin de Curso'] },
];

// Funci√≥n r√°pida para contar cu√°ntas tareas tienes de una efem√©ride concreta
const contarTareas = (tema: any) => {
  return tareas.filter(r => r.data.tematicas?.includes(tema)).length;
};
---

<Layout title="Calendario de Efem√©rides Escolares">
  <main class="container mx-auto p-4 py-12 max-w-4xl">
    
    <div class="text-center mb-16">
      <h1 class="text-4xl md:text-5xl font-bold text-gray-900 mb-4">Calendario Escolar</h1>
      <p class="text-xl text-gray-600">Proyectos y l√°minas secuenciadas por fechas clave y efem√©rides.</p>
    </div>

    <div class="relative border-l-4 border-orange-200 ml-4 md:ml-8 space-y-12 pb-12">
      
      {cursoEscolar.map((mesData) => (
        <div class="relative pl-8 md:pl-12">
          <div class="absolute -left-[26px] bg-orange-100 text-orange-600 w-12 h-12 rounded-full border-4 border-white flex items-center justify-center text-xl shadow-sm">
            {mesData.icono}
          </div>
          
          <h2 class="text-2xl font-bold text-gray-800 mb-6 pt-2">{mesData.mes}</h2>
          
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
            {mesData.eventos.map((evento) => {
              const numTareas = contarTareas(evento);
              const enlace = `/tematicas/${evento.toLowerCase().replace(/ /g, '-')}`;
              
              // Si hay tareas, usamos una etiqueta <a> (enlace). Si no, usamos un <div> est√°tico.
              const Elemento = numTareas > 0 ? 'a' : 'div';
              
              return (
                <Elemento 
                  href={numTareas > 0 ? enlace : undefined}
                  class={`group flex flex-col justify-between bg-white border border-gray-100 rounded-xl p-5 transition-all ${numTareas > 0 ? 'hover:border-orange-300 hover:shadow-md cursor-pointer' : 'opacity-70 cursor-default'}`}
                >
                  <span class={`font-bold transition-colors ${numTareas > 0 ? 'text-gray-700 group-hover:text-orange-600' : 'text-gray-400'}`}>
                    {evento}
                  </span>
                  
                  <span class={`text-sm mt-3 inline-block px-3 py-1 rounded-full w-max ${numTareas > 0 ? 'bg-orange-50 text-orange-700' : 'bg-gray-50 text-gray-400'}`}>
                    {numTareas} {numTareas === 1 ? 'recurso' : 'recursos'}
                  </span>
                </Elemento>
              );
            })}
          </div>
        </div>
      ))}
      
    </div>

  </main>
</Layout>